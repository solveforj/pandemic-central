"""
This module preprocesses JHU and NYC Public Health Department data.

Data source:
    https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_daily_reports
    https://www1.nyc.gov/site/doh/covid/covid-19-data.page
"""

import pandas as pd
from urllib.request import urlopen
import io
import os
from datetime import datetime

__author__ = 'Duy Cao, Joseph Galasso'
__copyright__ = '© Pandamic Central, 2020'
__license__ = 'MIT'
__status__ = 'release'
__url__ = 'https://github.com/solveforj/pandemic-central'
__version__ = '2.0.0'

def preprocess_JHU():
    print('• Processing JHU Case Data')

    # The Johns Hopkins COVID-19 dataset does not include data for individual counties in New York City
    # This data is retrieved from the New York City Public Health Department
    # Link: www1.nyc.gov/site/doh/covid/covid-19-data.page
    # Note: Daily data is obtained from the "Get the data" links on the Daily Counts graph, which are below
    bronx = "data:application/octet-stream;charset=utf-8,DATE_OF_INTEREST%2CCases%2CHospitalizations%2CDeaths%0A02%2F29%2F2020%2C0%2C3%2C0%0A03%2F01%2F2020%2C0%2C1%2C0%0A03%2F02%2F2020%2C0%2C9%2C0%0A03%2F03%2F2020%2C1%2C7%2C0%0A03%2F04%2F2020%2C0%2C6%2C0%0A03%2F05%2F2020%2C0%2C2%2C0%0A03%2F06%2F2020%2C2%2C5%2C0%0A03%2F07%2F2020%2C0%2C2%2C0%0A03%2F08%2F2020%2C4%2C2%2C0%0A03%2F09%2F2020%2C4%2C11%2C0%0A03%2F10%2F2020%2C8%2C8%2C0%0A03%2F11%2F2020%2C19%2C20%2C0%0A03%2F12%2F2020%2C29%2C16%2C0%0A03%2F13%2F2020%2C79%2C34%2C0%0A03%2F14%2F2020%2C86%2C26%2C0%0A03%2F15%2F2020%2C119%2C34%2C1%0A03%2F16%2F2020%2C303%2C65%2C3%0A03%2F17%2F2020%2C343%2C65%2C1%0A03%2F18%2F2020%2C483%2C98%2C1%0A03%2F19%2F2020%2C623%2C122%2C4%0A03%2F20%2F2020%2C723%2C112%2C13%0A03%2F21%2F2020%2C486%2C152%2C12%0A03%2F22%2F2020%2C493%2C163%2C12%0A03%2F23%2F2020%2C732%2C206%2C12%0A03%2F24%2F2020%2C926%2C253%2C14%0A03%2F25%2F2020%2C1057%2C288%2C31%0A03%2F26%2F2020%2C999%2C304%2C37%0A03%2F27%2F2020%2C1087%2C302%2C35%0A03%2F28%2F2020%2C762%2C302%2C62%0A03%2F29%2F2020%2C699%2C308%2C55%0A03%2F30%2F2020%2C1311%2C317%2C76%0A03%2F31%2F2020%2C1285%2C359%2C97%0A04%2F01%2F2020%2C1237%2C342%2C93%0A04%2F02%2F2020%2C1285%2C342%2C96%0A04%2F03%2F2020%2C1445%2C359%2C116%0A04%2F04%2F2020%2C1011%2C285%2C107%0A04%2F05%2F2020%2C821%2C318%2C124%0A04%2F06%2F2020%2C1510%2C384%2C112%0A04%2F07%2F2020%2C1466%2C335%2C114%0A04%2F08%2F2020%2C1299%2C373%2C114%0A04%2F09%2F2020%2C1283%2C303%2C108%0A04%2F10%2F2020%2C1230%2C303%2C118%0A04%2F11%2F2020%2C996%2C266%2C133%0A04%2F12%2F2020%2C761%2C239%2C110%0A04%2F13%2F2020%2C692%2C280%2C123%0A04%2F14%2F2020%2C1073%2C217%2C111%0A04%2F15%2F2020%2C1064%2C222%2C93%0A04%2F16%2F2020%2C932%2C198%2C85%0A04%2F17%2F2020%2C910%2C194%2C88%0A04%2F18%2F2020%2C550%2C159%2C61%0A04%2F19%2F2020%2C532%2C154%2C78%0A04%2F20%2F2020%2C975%2C164%2C78%0A04%2F21%2F2020%2C638%2C149%2C70%0A04%2F22%2F2020%2C921%2C130%2C67%0A04%2F23%2F2020%2C732%2C130%2C59%0A04%2F24%2F2020%2C579%2C116%2C62%0A04%2F25%2F2020%2C413%2C104%2C56%0A04%2F26%2F2020%2C194%2C87%2C54%0A04%2F27%2F2020%2C545%2C114%2C54%0A04%2F28%2F2020%2C666%2C108%2C56%0A04%2F29%2F2020%2C555%2C96%2C40%0A04%2F30%2F2020%2C480%2C71%2C45%0A05%2F01%2F2020%2C443%2C92%2C45%0A05%2F02%2F2020%2C259%2C63%2C49%0A05%2F03%2F2020%2C150%2C57%2C27%0A05%2F04%2F2020%2C347%2C68%2C35%0A05%2F05%2F2020%2C294%2C86%2C27%0A05%2F06%2F2020%2C281%2C71%2C29%0A05%2F07%2F2020%2C296%2C59%2C28%0A05%2F08%2F2020%2C252%2C70%2C22%0A05%2F09%2F2020%2C175%2C46%2C21%0A05%2F10%2F2020%2C74%2C36%2C13%0A05%2F11%2F2020%2C228%2C53%2C27%0A05%2F12%2F2020%2C354%2C52%2C20%0A05%2F13%2F2020%2C462%2C52%2C16%0A05%2F14%2F2020%2C255%2C47%2C10%0A05%2F15%2F2020%2C179%2C54%2C16%0A05%2F16%2F2020%2C109%2C30%2C26%0A05%2F17%2F2020%2C56%2C25%2C19%0A05%2F18%2F2020%2C186%2C34%2C10%0A05%2F19%2F2020%2C177%2C40%2C11%0A05%2F20%2F2020%2C273%2C38%2C15%0A05%2F21%2F2020%2C193%2C32%2C12%0A05%2F22%2F2020%2C259%2C41%2C12%0A05%2F23%2F2020%2C87%2C26%2C17%0A05%2F24%2F2020%2C98%2C24%2C13%0A05%2F25%2F2020%2C98%2C31%2C8%0A05%2F26%2F2020%2C270%2C40%2C10%0A05%2F27%2F2020%2C173%2C23%2C9%0A05%2F28%2F2020%2C113%2C22%2C12%0A05%2F29%2F2020%2C157%2C42%2C6%0A05%2F30%2F2020%2C76%2C26%2C12%0A05%2F31%2F2020%2C30%2C17%2C6%0A06%2F01%2F2020%2C155%2C27%2C3%0A06%2F02%2F2020%2C110%2C24%2C7%0A06%2F03%2F2020%2C99%2C19%2C10%0A06%2F04%2F2020%2C112%2C27%2C3%0A06%2F05%2F2020%2C102%2C16%2C7%0A06%2F06%2F2020%2C51%2C18%2C12%0A06%2F07%2F2020%2C42%2C18%2C7%0A06%2F08%2F2020%2C97%2C17%2C10%0A06%2F09%2F2020%2C82%2C17%2C6%0A06%2F10%2F2020%2C73%2C14%2C8%0A06%2F11%2F2020%2C62%2C15%2C6%0A06%2F12%2F2020%2C75%2C14%2C5%0A06%2F13%2F2020%2C44%2C9%2C4%0A06%2F14%2F2020%2C27%2C12%2C8%0A06%2F15%2F2020%2C69%2C13%2C5%0A06%2F16%2F2020%2C75%2C12%2C4%0A06%2F17%2F2020%2C68%2C13%2C2%0A06%2F18%2F2020%2C61%2C8%2C1%0A06%2F19%2F2020%2C79%2C10%2C3%0A06%2F20%2F2020%2C53%2C7%2C5%0A06%2F21%2F2020%2C25%2C6%2C5%0A06%2F22%2F2020%2C88%2C9%2C2%0A06%2F23%2F2020%2C73%2C15%2C8%0A06%2F24%2F2020%2C89%2C9%2C2%0A06%2F25%2F2020%2C64%2C13%2C3%0A06%2F26%2F2020%2C64%2C10%2C4%0A06%2F27%2F2020%2C26%2C8%2C1%0A06%2F28%2F2020%2C33%2C12%2C3%0A06%2F29%2F2020%2C74%2C8%2C7%0A06%2F30%2F2020%2C74%2C8%2C5%0A07%2F01%2F2020%2C60%2C8%2C1%0A07%2F02%2F2020%2C75%2C10%2C2%0A07%2F03%2F2020%2C40%2C3%2C6%0A07%2F04%2F2020%2C21%2C5%2C2%0A07%2F05%2F2020%2C20%2C5%2C5%0A07%2F06%2F2020%2C58%2C10%2C5%0A07%2F07%2F2020%2C104%2C20%2C2%0A07%2F08%2F2020%2C77%2C10%2C3%0A07%2F09%2F2020%2C68%2C18%2C3%0A07%2F10%2F2020%2C52%2C10%2C3%0A07%2F11%2F2020%2C26%2C6%2C2%0A07%2F12%2F2020%2C29%2C7%2C1%0A07%2F13%2F2020%2C66%2C15%2C3%0A07%2F14%2F2020%2C43%2C14%2C1%0A07%2F15%2F2020%2C38%2C6%2C1%0A07%2F16%2F2020%2C44%2C14%2C1%0A07%2F17%2F2020%2C38%2C5%2C0%0A07%2F18%2F2020%2C17%2C1%2C0%0A07%2F19%2F2020%2C4%2C0%2C0"

    brooklyn = "data:application/octet-stream;charset=utf-8,DATE_OF_INTEREST%2CCases%2CHospitalizations%2CDeaths%0A02%2F29%2F2020%2C0%2C4%2C0%0A03%2F01%2F2020%2C0%2C0%2C0%0A03%2F02%2F2020%2C0%2C4%2C0%0A03%2F03%2F2020%2C0%2C5%2C0%0A03%2F04%2F2020%2C1%2C5%2C0%0A03%2F05%2F2020%2C3%2C5%2C0%0A03%2F06%2F2020%2C1%2C3%2C0%0A03%2F07%2F2020%2C2%2C6%2C0%0A03%2F08%2F2020%2C5%2C9%2C0%0A03%2F09%2F2020%2C16%2C15%2C0%0A03%2F10%2F2020%2C11%2C13%2C0%0A03%2F11%2F2020%2C31%2C15%2C0%0A03%2F12%2F2020%2C96%2C30%2C0%0A03%2F13%2F2020%2C166%2C39%2C0%0A03%2F14%2F2020%2C164%2C38%2C1%0A03%2F15%2F2020%2C433%2C44%2C0%0A03%2F16%2F2020%2C741%2C86%2C1%0A03%2F17%2F2020%2C785%2C99%2C4%0A03%2F18%2F2020%2C970%2C115%2C6%0A03%2F19%2F2020%2C1205%2C149%2C6%0A03%2F20%2F2020%2C1139%2C187%2C11%0A03%2F21%2F2020%2C555%2C171%2C12%0A03%2F22%2F2020%2C756%2C183%2C10%0A03%2F23%2F2020%2C908%2C278%2C27%0A03%2F24%2F2020%2C1212%2C301%2C23%0A03%2F25%2F2020%2C1244%2C384%2C36%0A03%2F26%2F2020%2C1378%2C461%2C50%0A03%2F27%2F2020%2C1429%2C414%2C75%0A03%2F28%2F2020%2C863%2C372%2C78%0A03%2F29%2F2020%2C1146%2C428%2C90%0A03%2F30%2F2020%2C1757%2C521%2C106%0A03%2F31%2F2020%2C1517%2C489%2C126%0A04%2F01%2F2020%2C1608%2C473%2C136%0A04%2F02%2F2020%2C1642%2C406%2C168%0A04%2F03%2F2020%2C1448%2C404%2C141%0A04%2F04%2F2020%2C921%2C345%2C163%0A04%2F05%2F2020%2C1150%2C373%2C167%0A04%2F06%2F2020%2C1500%2C469%2C169%0A04%2F07%2F2020%2C1421%2C484%2C179%0A04%2F08%2F2020%2C1322%2C426%2C172%0A04%2F09%2F2020%2C1373%2C415%2C189%0A04%2F10%2F2020%2C1157%2C343%2C178%0A04%2F11%2F2020%2C1131%2C303%2C160%0A04%2F12%2F2020%2C701%2C263%2C200%0A04%2F13%2F2020%2C1065%2C341%2C158%0A04%2F14%2F2020%2C1037%2C275%2C153%0A04%2F15%2F2020%2C883%2C284%2C131%0A04%2F16%2F2020%2C883%2C247%2C126%0A04%2F17%2F2020%2C959%2C261%2C118%0A04%2F18%2F2020%2C575%2C175%2C117%0A04%2F19%2F2020%2C636%2C141%2C118%0A04%2F20%2F2020%2C982%2C213%2C95%0A04%2F21%2F2020%2C899%2C175%2C91%0A04%2F22%2F2020%2C853%2C161%2C108%0A04%2F23%2F2020%2C791%2C160%2C106%0A04%2F24%2F2020%2C629%2C142%2C93%0A04%2F25%2F2020%2C404%2C106%2C76%0A04%2F26%2F2020%2C332%2C89%2C61%0A04%2F27%2F2020%2C609%2C116%2C88%0A04%2F28%2F2020%2C715%2C124%2C57%0A04%2F29%2F2020%2C682%2C120%2C72%0A04%2F30%2F2020%2C600%2C98%2C66%0A05%2F01%2F2020%2C498%2C88%2C55%0A05%2F02%2F2020%2C264%2C63%2C46%0A05%2F03%2F2020%2C248%2C61%2C46%0A05%2F04%2F2020%2C463%2C90%2C42%0A05%2F05%2F2020%2C434%2C77%2C49%0A05%2F06%2F2020%2C452%2C76%2C38%0A05%2F07%2F2020%2C401%2C87%2C45%0A05%2F08%2F2020%2C349%2C78%2C43%0A05%2F09%2F2020%2C122%2C58%2C28%0A05%2F10%2F2020%2C191%2C43%2C26%0A05%2F11%2F2020%2C410%2C78%2C32%0A05%2F12%2F2020%2C400%2C58%2C33%0A05%2F13%2F2020%2C364%2C68%2C23%0A05%2F14%2F2020%2C333%2C62%2C14%0A05%2F15%2F2020%2C260%2C60%2C26%0A05%2F16%2F2020%2C165%2C47%2C24%0A05%2F17%2F2020%2C138%2C38%2C19%0A05%2F18%2F2020%2C269%2C61%2C15%0A05%2F19%2F2020%2C330%2C65%2C16%0A05%2F20%2F2020%2C326%2C50%2C21%0A05%2F21%2F2020%2C345%2C66%2C15%0A05%2F22%2F2020%2C387%2C62%2C14%0A05%2F23%2F2020%2C163%2C34%2C20%0A05%2F24%2F2020%2C178%2C34%2C12%0A05%2F25%2F2020%2C174%2C32%2C14%0A05%2F26%2F2020%2C339%2C34%2C11%0A05%2F27%2F2020%2C260%2C52%2C11%0A05%2F28%2F2020%2C226%2C47%2C12%0A05%2F29%2F2020%2C172%2C31%2C16%0A05%2F30%2F2020%2C111%2C29%2C11%0A05%2F31%2F2020%2C81%2C26%2C11%0A06%2F01%2F2020%2C253%2C37%2C10%0A06%2F02%2F2020%2C198%2C31%2C6%0A06%2F03%2F2020%2C145%2C39%2C13%0A06%2F04%2F2020%2C143%2C31%2C10%0A06%2F05%2F2020%2C132%2C20%2C6%0A06%2F06%2F2020%2C60%2C12%2C10%0A06%2F07%2F2020%2C54%2C15%2C5%0A06%2F08%2F2020%2C113%2C20%2C13%0A06%2F09%2F2020%2C129%2C17%2C7%0A06%2F10%2F2020%2C99%2C9%2C11%0A06%2F11%2F2020%2C108%2C13%2C5%0A06%2F12%2F2020%2C124%2C21%2C6%0A06%2F13%2F2020%2C54%2C9%2C4%0A06%2F14%2F2020%2C55%2C11%2C7%0A06%2F15%2F2020%2C111%2C20%2C4%0A06%2F16%2F2020%2C134%2C15%2C5%0A06%2F17%2F2020%2C108%2C10%2C7%0A06%2F18%2F2020%2C112%2C13%2C4%0A06%2F19%2F2020%2C90%2C22%2C3%0A06%2F20%2F2020%2C45%2C10%2C4%0A06%2F21%2F2020%2C52%2C14%2C6%0A06%2F22%2F2020%2C109%2C16%2C7%0A06%2F23%2F2020%2C95%2C13%2C9%0A06%2F24%2F2020%2C100%2C11%2C11%0A06%2F25%2F2020%2C82%2C8%2C6%0A06%2F26%2F2020%2C93%2C15%2C4%0A06%2F27%2F2020%2C66%2C18%2C11%0A06%2F28%2F2020%2C58%2C10%2C1%0A06%2F29%2F2020%2C126%2C19%2C5%0A06%2F30%2F2020%2C134%2C15%2C5%0A07%2F01%2F2020%2C120%2C9%2C5%0A07%2F02%2F2020%2C125%2C8%2C4%0A07%2F03%2F2020%2C71%2C15%2C6%0A07%2F04%2F2020%2C22%2C6%2C6%0A07%2F05%2F2020%2C55%2C3%2C5%0A07%2F06%2F2020%2C125%2C15%2C5%0A07%2F07%2F2020%2C100%2C7%2C4%0A07%2F08%2F2020%2C104%2C11%2C5%0A07%2F09%2F2020%2C78%2C7%2C3%0A07%2F10%2F2020%2C68%2C14%2C3%0A07%2F11%2F2020%2C56%2C12%2C2%0A07%2F12%2F2020%2C37%2C5%2C4%0A07%2F13%2F2020%2C86%2C14%2C2%0A07%2F14%2F2020%2C75%2C8%2C3%0A07%2F15%2F2020%2C83%2C10%2C0%0A07%2F16%2F2020%2C46%2C4%2C1%0A07%2F17%2F2020%2C34%2C4%2C0%0A07%2F18%2F2020%2C12%2C0%2C1%0A07%2F19%2F2020%2C1%2C0%2C0"

    manhattan = "data:application/octet-stream;charset=utf-8,DATE_OF_INTEREST%2CCases%2CHospitalizations%2CDeaths%0A02%2F29%2F2020%2C1%2C2%2C0%0A03%2F01%2F2020%2C0%2C0%2C0%0A03%2F02%2F2020%2C0%2C4%2C0%0A03%2F03%2F2020%2C0%2C2%2C0%0A03%2F04%2F2020%2C2%2C6%2C0%0A03%2F05%2F2020%2C0%2C6%2C0%0A03%2F06%2F2020%2C3%2C3%2C0%0A03%2F07%2F2020%2C1%2C4%2C0%0A03%2F08%2F2020%2C6%2C1%2C0%0A03%2F09%2F2020%2C25%2C12%2C0%0A03%2F10%2F2020%2C24%2C13%2C0%0A03%2F11%2F2020%2C62%2C22%2C0%0A03%2F12%2F2020%2C137%2C13%2C0%0A03%2F13%2F2020%2C182%2C30%2C0%0A03%2F14%2F2020%2C177%2C29%2C0%0A03%2F15%2F2020%2C207%2C30%2C2%0A03%2F16%2F2020%2C457%2C41%2C0%0A03%2F17%2F2020%2C568%2C60%2C0%0A03%2F18%2F2020%2C541%2C82%2C4%0A03%2F19%2F2020%2C555%2C96%2C4%0A03%2F20%2F2020%2C655%2C110%2C11%0A03%2F21%2F2020%2C401%2C115%2C5%0A03%2F22%2F2020%2C319%2C124%2C8%0A03%2F23%2F2020%2C533%2C174%2C7%0A03%2F24%2F2020%2C625%2C188%2C17%0A03%2F25%2F2020%2C594%2C182%2C20%0A03%2F26%2F2020%2C628%2C215%2C33%0A03%2F27%2F2020%2C657%2C202%2C42%0A03%2F28%2F2020%2C385%2C202%2C28%0A03%2F29%2F2020%2C409%2C158%2C35%0A03%2F30%2F2020%2C808%2C256%2C35%0A03%2F31%2F2020%2C627%2C214%2C42%0A04%2F01%2F2020%2C576%2C169%2C59%0A04%2F02%2F2020%2C654%2C227%2C62%0A04%2F03%2F2020%2C679%2C258%2C52%0A04%2F04%2F2020%2C385%2C191%2C63%0A04%2F05%2F2020%2C358%2C181%2C86%0A04%2F06%2F2020%2C719%2C259%2C69%0A04%2F07%2F2020%2C605%2C194%2C92%0A04%2F08%2F2020%2C553%2C174%2C66%0A04%2F09%2F2020%2C563%2C202%2C65%0A04%2F10%2F2020%2C500%2C190%2C69%0A04%2F11%2F2020%2C312%2C130%2C59%0A04%2F12%2F2020%2C253%2C141%2C63%0A04%2F13%2F2020%2C393%2C187%2C72%0A04%2F14%2F2020%2C444%2C162%2C59%0A04%2F15%2F2020%2C432%2C142%2C55%0A04%2F16%2F2020%2C360%2C111%2C57%0A04%2F17%2F2020%2C332%2C124%2C41%0A04%2F18%2F2020%2C188%2C89%2C57%0A04%2F19%2F2020%2C176%2C81%2C48%0A04%2F20%2F2020%2C382%2C93%2C49%0A04%2F21%2F2020%2C374%2C99%2C46%0A04%2F22%2F2020%2C388%2C110%2C37%0A04%2F23%2F2020%2C402%2C70%2C48%0A04%2F24%2F2020%2C415%2C92%2C48%0A04%2F25%2F2020%2C149%2C50%2C43%0A04%2F26%2F2020%2C99%2C50%2C34%0A04%2F27%2F2020%2C305%2C70%2C29%0A04%2F28%2F2020%2C325%2C72%2C34%0A04%2F29%2F2020%2C287%2C52%2C33%0A04%2F30%2F2020%2C218%2C43%2C34%0A05%2F01%2F2020%2C247%2C49%2C25%0A05%2F02%2F2020%2C141%2C30%2C23%0A05%2F03%2F2020%2C103%2C43%2C35%0A05%2F04%2F2020%2C217%2C54%2C19%0A05%2F05%2F2020%2C245%2C41%2C18%0A05%2F06%2F2020%2C167%2C37%2C17%0A05%2F07%2F2020%2C119%2C34%2C23%0A05%2F08%2F2020%2C100%2C40%2C13%0A05%2F09%2F2020%2C74%2C28%2C15%0A05%2F10%2F2020%2C95%2C30%2C20%0A05%2F11%2F2020%2C193%2C40%2C14%0A05%2F12%2F2020%2C164%2C30%2C14%0A05%2F13%2F2020%2C155%2C42%2C8%0A05%2F14%2F2020%2C150%2C30%2C17%0A05%2F15%2F2020%2C137%2C43%2C11%0A05%2F16%2F2020%2C56%2C18%2C10%0A05%2F17%2F2020%2C50%2C18%2C11%0A05%2F18%2F2020%2C134%2C28%2C10%0A05%2F19%2F2020%2C169%2C40%2C10%0A05%2F20%2F2020%2C168%2C25%2C12%0A05%2F21%2F2020%2C146%2C26%2C6%0A05%2F22%2F2020%2C156%2C34%2C5%0A05%2F23%2F2020%2C47%2C20%2C7%0A05%2F24%2F2020%2C71%2C29%2C6%0A05%2F25%2F2020%2C71%2C25%2C12%0A05%2F26%2F2020%2C127%2C27%2C6%0A05%2F27%2F2020%2C111%2C28%2C9%0A05%2F28%2F2020%2C97%2C27%2C3%0A05%2F29%2F2020%2C75%2C30%2C5%0A05%2F30%2F2020%2C39%2C12%2C12%0A05%2F31%2F2020%2C25%2C14%2C5%0A06%2F01%2F2020%2C80%2C23%2C3%0A06%2F02%2F2020%2C72%2C25%2C9%0A06%2F03%2F2020%2C78%2C24%2C7%0A06%2F04%2F2020%2C90%2C15%2C7%0A06%2F05%2F2020%2C61%2C10%2C7%0A06%2F06%2F2020%2C31%2C8%2C2%0A06%2F07%2F2020%2C24%2C6%2C1%0A06%2F08%2F2020%2C75%2C8%2C3%0A06%2F09%2F2020%2C68%2C7%2C8%0A06%2F10%2F2020%2C70%2C9%2C2%0A06%2F11%2F2020%2C60%2C4%2C2%0A06%2F12%2F2020%2C65%2C6%2C3%0A06%2F13%2F2020%2C24%2C3%2C3%0A06%2F14%2F2020%2C30%2C6%2C2%0A06%2F15%2F2020%2C61%2C4%2C3%0A06%2F16%2F2020%2C69%2C5%2C3%0A06%2F17%2F2020%2C67%2C5%2C3%0A06%2F18%2F2020%2C58%2C5%2C4%0A06%2F19%2F2020%2C57%2C5%2C4%0A06%2F20%2F2020%2C43%2C5%2C2%0A06%2F21%2F2020%2C29%2C3%2C4%0A06%2F22%2F2020%2C60%2C6%2C5%0A06%2F23%2F2020%2C76%2C4%2C5%0A06%2F24%2F2020%2C70%2C5%2C3%0A06%2F25%2F2020%2C45%2C4%2C4%0A06%2F26%2F2020%2C65%2C4%2C6%0A06%2F27%2F2020%2C41%2C6%2C2%0A06%2F28%2F2020%2C41%2C4%2C7%0A06%2F29%2F2020%2C81%2C4%2C3%0A06%2F30%2F2020%2C95%2C5%2C4%0A07%2F01%2F2020%2C86%2C6%2C2%0A07%2F02%2F2020%2C83%2C4%2C11%0A07%2F03%2F2020%2C46%2C3%2C2%0A07%2F04%2F2020%2C31%2C7%2C2%0A07%2F05%2F2020%2C30%2C5%2C4%0A07%2F06%2F2020%2C75%2C5%2C5%0A07%2F07%2F2020%2C78%2C8%2C2%0A07%2F08%2F2020%2C95%2C6%2C3%0A07%2F09%2F2020%2C78%2C5%2C2%0A07%2F10%2F2020%2C38%2C2%2C1%0A07%2F11%2F2020%2C31%2C5%2C4%0A07%2F12%2F2020%2C22%2C4%2C0%0A07%2F13%2F2020%2C57%2C5%2C5%0A07%2F14%2F2020%2C45%2C3%2C1%0A07%2F15%2F2020%2C33%2C2%2C0%0A07%2F16%2F2020%2C39%2C6%2C1%0A07%2F17%2F2020%2C33%2C5%2C0%0A07%2F18%2F2020%2C10%2C0%2C1%0A07%2F19%2F2020%2C0%2C0%2C0"

    queens = 'data:application/octet-stream;charset=utf-8,DATE_OF_INTEREST%2CCases%2CHospitalizations%2CDeaths%0A02%2F29%2F2020%2C0%2C2%2C0%0A03%2F01%2F2020%2C0%2C2%2C0%0A03%2F02%2F2020%2C0%2C5%2C0%0A03%2F03%2F2020%2C1%2C5%2C0%0A03%2F04%2F2020%2C2%2C3%2C0%0A03%2F05%2F2020%2C0%2C6%2C0%0A03%2F06%2F2020%2C1%2C5%2C0%0A03%2F07%2F2020%2C3%2C3%2C0%0A03%2F08%2F2020%2C5%2C5%2C0%0A03%2F09%2F2020%2C10%2C8%2C0%0A03%2F10%2F2020%2C24%2C23%2C0%0A03%2F11%2F2020%2C40%2C30%2C1%0A03%2F12%2F2020%2C80%2C28%2C0%0A03%2F13%2F2020%2C166%2C50%2C0%0A03%2F14%2F2020%2C194%2C58%2C1%0A03%2F15%2F2020%2C230%2C65%2C1%0A03%2F16%2F2020%2C529%2C107%2C4%0A03%2F17%2F2020%2C649%2C111%2C3%0A03%2F18%2F2020%2C832%2C152%2C10%0A03%2F19%2F2020%2C1065%2C160%2C6%0A03%2F20%2F2020%2C1184%2C224%2C9%0A03%2F21%2F2020%2C947%2C227%2C14%0A03%2F22%2F2020%2C696%2C223%2C14%0A03%2F23%2F2020%2C1189%2C332%2C28%0A03%2F24%2F2020%2C1392%2C362%2C35%0A03%2F25%2F2020%2C1574%2C400%2C32%0A03%2F26%2F2020%2C1641%2C426%2C60%0A03%2F27%2F2020%2C1578%2C416%2C58%0A03%2F28%2F2020%2C1201%2C435%2C92%0A03%2F29%2F2020%2C1076%2C455%2C94%0A03%2F30%2F2020%2C1853%2C554%2C99%0A03%2F31%2F2020%2C1806%2C561%2C96%0A04%2F01%2F2020%2C1778%2C529%2C143%0A04%2F02%2F2020%2C1817%2C563%2C141%0A04%2F03%2F2020%2C1758%2C517%2C160%0A04%2F04%2F2020%2C1201%2C470%2C157%0A04%2F05%2F2020%2C1137%2C390%2C182%0A04%2F06%2F2020%2C1918%2C531%2C202%0A04%2F07%2F2020%2C1942%2C522%2C183%0A04%2F08%2F2020%2C1848%2C511%2C182%0A04%2F09%2F2020%2C1555%2C453%2C172%0A04%2F10%2F2020%2C1329%2C447%2C155%0A04%2F11%2F2020%2C980%2C349%2C163%0A04%2F12%2F2020%2C920%2C308%2C174%0A04%2F13%2F2020%2C974%2C349%2C192%0A04%2F14%2F2020%2C1300%2C382%2C163%0A04%2F15%2F2020%2C1179%2C301%2C151%0A04%2F16%2F2020%2C1140%2C288%2C131%0A04%2F17%2F2020%2C1099%2C286%2C122%0A04%2F18%2F2020%2C703%2C213%2C136%0A04%2F19%2F2020%2C868%2C188%2C136%0A04%2F20%2F2020%2C1221%2C222%2C126%0A04%2F21%2F2020%2C934%2C210%2C103%0A04%2F22%2F2020%2C1111%2C177%2C86%0A04%2F23%2F2020%2C788%2C154%2C106%0A04%2F24%2F2020%2C773%2C166%2C98%0A04%2F25%2F2020%2C540%2C117%2C81%0A04%2F26%2F2020%2C331%2C126%2C90%0A04%2F27%2F2020%2C722%2C122%2C91%0A04%2F28%2F2020%2C893%2C118%2C73%0A04%2F29%2F2020%2C692%2C119%2C81%0A04%2F30%2F2020%2C592%2C112%2C66%0A05%2F01%2F2020%2C620%2C107%2C76%0A05%2F02%2F2020%2C333%2C87%2C61%0A05%2F03%2F2020%2C247%2C79%2C55%0A05%2F04%2F2020%2C432%2C82%2C55%0A05%2F05%2F2020%2C461%2C67%2C45%0A05%2F06%2F2020%2C443%2C66%2C58%0A05%2F07%2F2020%2C357%2C65%2C41%0A05%2F08%2F2020%2C343%2C55%2C48%0A05%2F09%2F2020%2C256%2C43%2C33%0A05%2F10%2F2020%2C85%2C37%2C35%0A05%2F11%2F2020%2C376%2C71%2C27%0A05%2F12%2F2020%2C313%2C53%2C18%0A05%2F13%2F2020%2C307%2C52%2C30%0A05%2F14%2F2020%2C332%2C63%2C23%0A05%2F15%2F2020%2C265%2C64%2C27%0A05%2F16%2F2020%2C134%2C60%2C21%0A05%2F17%2F2020%2C106%2C37%2C26%0A05%2F18%2F2020%2C272%2C48%2C20%0A05%2F19%2F2020%2C288%2C48%2C12%0A05%2F20%2F2020%2C248%2C45%2C26%0A05%2F21%2F2020%2C308%2C38%2C9%0A05%2F22%2F2020%2C227%2C49%2C28%0A05%2F23%2F2020%2C130%2C43%2C14%0A05%2F24%2F2020%2C118%2C28%2C13%0A05%2F25%2F2020%2C107%2C46%2C12%0A05%2F26%2F2020%2C262%2C45%2C9%0A05%2F27%2F2020%2C164%2C53%2C18%0A05%2F28%2F2020%2C175%2C35%2C10%0A05%2F29%2F2020%2C211%2C46%2C14%0A05%2F30%2F2020%2C107%2C24%2C17%0A05%2F31%2F2020%2C69%2C31%2C15%0A06%2F01%2F2020%2C140%2C35%2C15%0A06%2F02%2F2020%2C160%2C37%2C15%0A06%2F03%2F2020%2C147%2C28%2C9%0A06%2F04%2F2020%2C137%2C15%2C10%0A06%2F05%2F2020%2C105%2C17%2C5%0A06%2F06%2F2020%2C98%2C9%2C11%0A06%2F07%2F2020%2C74%2C6%2C10%0A06%2F08%2F2020%2C143%2C15%2C15%0A06%2F09%2F2020%2C126%2C8%2C9%0A06%2F10%2F2020%2C111%2C11%2C8%0A06%2F11%2F2020%2C110%2C8%2C7%0A06%2F12%2F2020%2C128%2C12%2C9%0A06%2F13%2F2020%2C73%2C7%2C2%0A06%2F14%2F2020%2C69%2C13%2C5%0A06%2F15%2F2020%2C118%2C11%2C6%0A06%2F16%2F2020%2C122%2C16%2C7%0A06%2F17%2F2020%2C91%2C13%2C8%0A06%2F18%2F2020%2C117%2C14%2C6%0A06%2F19%2F2020%2C119%2C3%2C5%0A06%2F20%2F2020%2C57%2C5%2C5%0A06%2F21%2F2020%2C58%2C8%2C11%0A06%2F22%2F2020%2C116%2C8%2C8%0A06%2F23%2F2020%2C116%2C9%2C5%0A06%2F24%2F2020%2C103%2C11%2C8%0A06%2F25%2F2020%2C79%2C10%2C4%0A06%2F26%2F2020%2C77%2C2%2C5%0A06%2F27%2F2020%2C59%2C4%2C6%0A06%2F28%2F2020%2C55%2C6%2C6%0A06%2F29%2F2020%2C132%2C7%2C7%0A06%2F30%2F2020%2C111%2C7%2C8%0A07%2F01%2F2020%2C92%2C7%2C3%0A07%2F02%2F2020%2C114%2C8%2C6%0A07%2F03%2F2020%2C64%2C2%2C7%0A07%2F04%2F2020%2C33%2C5%2C3%0A07%2F05%2F2020%2C40%2C11%2C2%0A07%2F06%2F2020%2C111%2C11%2C4%0A07%2F07%2F2020%2C92%2C7%2C4%0A07%2F08%2F2020%2C62%2C3%2C5%0A07%2F09%2F2020%2C65%2C9%2C1%0A07%2F10%2F2020%2C63%2C12%2C1%0A07%2F11%2F2020%2C67%2C5%2C5%0A07%2F12%2F2020%2C45%2C3%2C4%0A07%2F13%2F2020%2C79%2C8%2C3%0A07%2F14%2F2020%2C61%2C8%2C3%0A07%2F15%2F2020%2C40%2C4%2C5%0A07%2F16%2F2020%2C53%2C3%2C2%0A07%2F17%2F2020%2C53%2C7%2C0%0A07%2F18%2F2020%2C9%2C0%2C1%0A07%2F19%2F2020%2C0%2C0%2C0'

    staten_island = "data:application/octet-stream;charset=utf-8,DATE_OF_INTEREST%2CCases%2CHospitalizations%2CDeaths%0A02%2F29%2F2020%2C0%2C0%2C0%0A03%2F01%2F2020%2C0%2C1%2C0%0A03%2F02%2F2020%2C0%2C0%2C0%0A03%2F03%2F2020%2C0%2C1%2C0%0A03%2F04%2F2020%2C0%2C2%2C0%0A03%2F05%2F2020%2C0%2C1%2C0%0A03%2F06%2F2020%2C1%2C2%2C0%0A03%2F07%2F2020%2C1%2C0%2C0%0A03%2F08%2F2020%2C1%2C0%2C0%0A03%2F09%2F2020%2C3%2C3%2C0%0A03%2F10%2F2020%2C2%2C5%2C0%0A03%2F11%2F2020%2C3%2C3%2C0%0A03%2F12%2F2020%2C13%2C5%2C0%0A03%2F13%2F2020%2C26%2C3%2C0%0A03%2F14%2F2020%2C23%2C8%2C0%0A03%2F15%2F2020%2C46%2C16%2C1%0A03%2F16%2F2020%2C91%2C17%2C0%0A03%2F17%2F2020%2C108%2C21%2C0%0A03%2F18%2F2020%2C150%2C24%2C0%0A03%2F19%2F2020%2C258%2C32%2C4%0A03%2F20%2F2020%2C309%2C30%2C3%0A03%2F21%2F2020%2C248%2C35%2C1%0A03%2F22%2F2020%2C317%2C32%2C6%0A03%2F23%2F2020%2C209%2C46%2C8%0A03%2F24%2F2020%2C349%2C48%2C6%0A03%2F25%2F2020%2C394%2C49%2C4%0A03%2F26%2F2020%2C404%2C48%2C10%0A03%2F27%2F2020%2C371%2C57%2C7%0A03%2F28%2F2020%2C266%2C53%2C13%0A03%2F29%2F2020%2C230%2C57%2C17%0A03%2F30%2F2020%2C398%2C68%2C11%0A03%2F31%2F2020%2C236%2C69%2C22%0A04%2F01%2F2020%2C263%2C74%2C16%0A04%2F02%2F2020%2C369%2C79%2C30%0A04%2F03%2F2020%2C345%2C63%2C29%0A04%2F04%2F2020%2C345%2C51%2C20%0A04%2F05%2F2020%2C323%2C65%2C22%0A04%2F06%2F2020%2C730%2C81%2C24%0A04%2F07%2F2020%2C629%2C70%2C29%0A04%2F08%2F2020%2C561%2C57%2C34%0A04%2F09%2F2020%2C297%2C56%2C25%0A04%2F10%2F2020%2C300%2C54%2C19%0A04%2F11%2F2020%2C312%2C49%2C28%0A04%2F12%2F2020%2C252%2C45%2C26%0A04%2F13%2F2020%2C185%2C56%2C25%0A04%2F14%2F2020%2C290%2C52%2C24%0A04%2F15%2F2020%2C317%2C33%2C24%0A04%2F16%2F2020%2C210%2C38%2C14%0A04%2F17%2F2020%2C280%2C38%2C15%0A04%2F18%2F2020%2C153%2C25%2C19%0A04%2F19%2F2020%2C134%2C31%2C19%0A04%2F20%2F2020%2C224%2C29%2C16%0A04%2F21%2F2020%2C216%2C27%2C11%0A04%2F22%2F2020%2C173%2C20%2C14%0A04%2F23%2F2020%2C127%2C19%2C13%0A04%2F24%2F2020%2C143%2C34%2C14%0A04%2F25%2F2020%2C88%2C26%2C9%0A04%2F26%2F2020%2C46%2C23%2C7%0A04%2F27%2F2020%2C107%2C20%2C9%0A04%2F28%2F2020%2C129%2C19%2C8%0A04%2F29%2F2020%2C124%2C19%2C14%0A04%2F30%2F2020%2C130%2C19%2C11%0A05%2F01%2F2020%2C77%2C12%2C8%0A05%2F02%2F2020%2C60%2C18%2C12%0A05%2F03%2F2020%2C35%2C15%2C15%0A05%2F04%2F2020%2C89%2C15%2C8%0A05%2F05%2F2020%2C78%2C12%2C12%0A05%2F06%2F2020%2C60%2C7%2C8%0A05%2F07%2F2020%2C60%2C7%2C4%0A05%2F08%2F2020%2C42%2C10%2C5%0A05%2F09%2F2020%2C32%2C7%2C3%0A05%2F10%2F2020%2C14%2C5%2C8%0A05%2F11%2F2020%2C27%2C4%2C3%0A05%2F12%2F2020%2C53%2C8%2C6%0A05%2F13%2F2020%2C47%2C9%2C6%0A05%2F14%2F2020%2C42%2C13%2C6%0A05%2F15%2F2020%2C33%2C7%2C6%0A05%2F16%2F2020%2C25%2C9%2C2%0A05%2F17%2F2020%2C10%2C4%2C2%0A05%2F18%2F2020%2C38%2C4%2C2%0A05%2F19%2F2020%2C42%2C8%2C5%0A05%2F20%2F2020%2C57%2C6%2C7%0A05%2F21%2F2020%2C78%2C10%2C3%0A05%2F22%2F2020%2C32%2C7%2C5%0A05%2F23%2F2020%2C37%2C6%2C2%0A05%2F24%2F2020%2C14%2C4%2C5%0A05%2F25%2F2020%2C17%2C5%2C3%0A05%2F26%2F2020%2C56%2C3%2C1%0A05%2F27%2F2020%2C44%2C3%2C2%0A05%2F28%2F2020%2C26%2C8%2C1%0A05%2F29%2F2020%2C27%2C9%2C2%0A05%2F30%2F2020%2C16%2C3%2C1%0A05%2F31%2F2020%2C12%2C2%2C2%0A06%2F01%2F2020%2C38%2C2%2C3%0A06%2F02%2F2020%2C34%2C6%2C1%0A06%2F03%2F2020%2C44%2C5%2C3%0A06%2F04%2F2020%2C29%2C1%2C2%0A06%2F05%2F2020%2C9%2C1%2C1%0A06%2F06%2F2020%2C7%2C0%2C0%0A06%2F07%2F2020%2C4%2C0%2C1%0A06%2F08%2F2020%2C16%2C2%2C0%0A06%2F09%2F2020%2C20%2C1%2C2%0A06%2F10%2F2020%2C14%2C2%2C2%0A06%2F11%2F2020%2C15%2C1%2C1%0A06%2F12%2F2020%2C18%2C1%2C0%0A06%2F13%2F2020%2C1%2C1%2C1%0A06%2F14%2F2020%2C4%2C0%2C2%0A06%2F15%2F2020%2C17%2C0%2C2%0A06%2F16%2F2020%2C20%2C0%2C0%0A06%2F17%2F2020%2C16%2C0%2C0%0A06%2F18%2F2020%2C23%2C0%2C2%0A06%2F19%2F2020%2C8%2C0%2C2%0A06%2F20%2F2020%2C6%2C0%2C2%0A06%2F21%2F2020%2C9%2C2%2C2%0A06%2F22%2F2020%2C18%2C2%2C3%0A06%2F23%2F2020%2C16%2C1%2C0%0A06%2F24%2F2020%2C13%2C1%2C1%0A06%2F25%2F2020%2C25%2C1%2C2%0A06%2F26%2F2020%2C12%2C3%2C1%0A06%2F27%2F2020%2C12%2C1%2C1%0A06%2F28%2F2020%2C11%2C0%2C2%0A06%2F29%2F2020%2C24%2C1%2C3%0A06%2F30%2F2020%2C27%2C2%2C2%0A07%2F01%2F2020%2C39%2C0%2C1%0A07%2F02%2F2020%2C16%2C0%2C4%0A07%2F03%2F2020%2C6%2C1%2C2%0A07%2F04%2F2020%2C11%2C0%2C1%0A07%2F05%2F2020%2C11%2C0%2C0%0A07%2F06%2F2020%2C25%2C1%2C0%0A07%2F07%2F2020%2C27%2C0%2C1%0A07%2F08%2F2020%2C21%2C1%2C4%0A07%2F09%2F2020%2C21%2C0%2C0%0A07%2F10%2F2020%2C9%2C0%2C1%0A07%2F11%2F2020%2C10%2C0%2C0%0A07%2F12%2F2020%2C5%2C0%2C0%0A07%2F13%2F2020%2C28%2C2%2C1%0A07%2F14%2F2020%2C16%2C0%2C0%0A07%2F15%2F2020%2C10%2C1%2C0%0A07%2F16%2F2020%2C14%2C0%2C0%0A07%2F17%2F2020%2C6%2C0%2C0%0A07%2F18%2F2020%2C1%2C0%2C0%0A07%2F19%2F2020%2C0%2C0%2C00"

    nyFIPS = {"bronx" : "36005", "brooklyn": "36047", "manhattan":"36061", "queens":"36081", "staten_island":"36085"}

    def read_NYC_county(county_link, fips):
        with urlopen(county_link) as response:
            data = response.read().decode("utf8")
            df = pd.read_csv(io.StringIO(data))
            df.insert(0,"FIPS", [nyFIPS[fips]]*len(df))
            df = df.drop(['Hospitalizations','Deaths'], axis=1)
            df = df.rename({'DATE_OF_INTEREST':'date', 'Cases':'confirmed_cases'}, axis=1)
            df['date'] = pd.to_datetime(df['date'])
            return df

    def process_FIPS(fips):
        num = fips[0:-2]
        missing_zeroes = 5 - len(num)
        missing_zeroes = "0" * missing_zeroes
        return missing_zeroes + num

    # Get daily case data from New York City counties
    bronx = read_NYC_county(bronx, "bronx")
    brooklyn = read_NYC_county(brooklyn, "brooklyn")
    manhattan = read_NYC_county(manhattan, "manhattan")
    queens = read_NYC_county(queens, "queens")
    staten_island = read_NYC_county(staten_island, "staten_island")

    # Get all other data from Johns Hopkins
    jhu_data = pd.read_csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv", dtype={"FIPS": str})
    jhu_data = jhu_data[jhu_data['FIPS'].notnull()]
    jhu_data['FIPS'] = jhu_data['FIPS'].apply(lambda x : process_FIPS(x))
    jhu_data = jhu_data.drop(["Admin2","Province_State","Country_Region","Lat","Long_","Combined_Key","UID","iso2","iso3","code3"], axis=1)
    jhu_data = jhu_data.melt(id_vars=['FIPS'], var_name = 'date', value_name = 'confirmed_cases')
    jhu_data['date'] = pd.to_datetime(jhu_data['date'])
    jhu_data = jhu_data.sort_values(['FIPS', 'date'])

    # Case counts are cumulative and will be converted into daily change
    jhu_data['confirmed_cases'] = jhu_data.groupby('FIPS')['confirmed_cases'].diff().dropna()

    # Merge Johns Hopkins Data with NYC data
    ny_fips_list = ["36005","36047","36061", "36081", "36085"]
    jhu_data = jhu_data[~jhu_data['FIPS'].isin(ny_fips_list)]
    full_data = pd.concat([jhu_data, bronx, brooklyn, manhattan, queens, staten_island])

    full_data = full_data.sort_values(['FIPS','date'], axis=0)
    full_data = full_data.reset_index(drop=True)

    # Compute 14-day (weekly) rolling average of cases for each county
    full_data['confirmed_cases'] = pd.Series(full_data.groupby("FIPS")['confirmed_cases'].rolling(14).mean()).reset_index(drop=True)
    full_data = full_data[full_data['confirmed_cases'].notnull()]

    # Move dates forward by 1 day so that movement averages represent data from past week
    full_data['date'] = pd.to_datetime(full_data['date'])
    full_data['date'] = full_data['date'].apply(pd.DateOffset(1))

    # Normalize confirmed cases for population and export to csv
    census_data = pd.read_csv("data/census/census.csv", dtype={'FIPS':str})[['FIPS', 'TOT_POP']]

    merged_df = pd.merge(left=census_data, right=full_data, how='left', on='FIPS', copy=False)
    merged_df['confirmed_cases_norm'] = (merged_df['confirmed_cases']/merged_df['TOT_POP'] * 100000).round()
    merged_df = merged_df.drop('TOT_POP', axis=1)
    startdate = datetime.strptime('2020-2-15', '%Y-%m-%d')
    merged_df = merged_df[merged_df['date'] >= startdate]

    merged_df.to_csv('data/JHU/jhu_data.csv', sep=",", index=False)

    print('  Finished\n')

if __name__ == "__main__":
    preprocess_JHU()
